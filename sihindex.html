<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicConnect - Report Issues</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#218085">
    <meta name="description" content="Report and track civic issues in your community">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>CivicConnect</h2>
            <p>Loading your civic engagement platform...</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <h1>CivicConnect</h1>
                <p>Your Voice, Your Community</p>
            </div>
            
            <div class="login-form">
                <h2>Sign In with DigiLocker</h2>
                <p class="text-secondary">Secure AADHAR-based authentication</p>
                
                <div id="phone-input-section">
                    <div class="form-group">
                        <label class="form-label">Mobile Number</label>
                        <input type="tel" class="form-control" id="phone-number" placeholder="+91-9876543210" value="+91-9876543210">
                    </div>
                    <button class="btn btn--primary btn--full-width" onclick="sendOTP()">Send OTP via DigiLocker</button>
                </div>
                
                <div id="otp-input-section" class="hidden">
                    <div class="form-group">
                        <label class="form-label">Enter OTP</label>
                        <input type="text" class="form-control" id="otp-input" placeholder="Enter 6-digit OTP" maxlength="6">
                    </div>
                    <p class="text-secondary">OTP sent to your registered mobile number</p>
                    <button class="btn btn--primary btn--full-width" onclick="verifyOTP()">Verify & Sign In</button>
                    <button class="btn btn--secondary btn--full-width mt-8" onclick="resendOTP()">Resend OTP</button>
                </div>
            </div>
            
            <div class="login-footer">
                <p>By signing in, you agree to our Terms of Service and Privacy Policy</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="screen">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="header-title">CivicConnect</h1>
                    <p class="header-subtitle" id="user-location">MG Road, Bangalore</p>
                </div>
                <div class="header-right">
                    <button class="btn btn--secondary btn--sm" onclick="toggleTheme()">üåì</button>
                    <button class="btn btn--secondary btn--sm" onclick="showUserProfile()">üë§</button>
                    <select class="form-control" id="language-selector" onchange="changeLanguage()">
                        <option value="en">English</option>
                        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard Home -->
            <div id="dashboard-view" class="view active">
                <div class="dashboard-grid">
                    <div class="dashboard-card" onclick="showView('report-view')">
                        <div class="card-icon">üì∏</div>
                        <h3>Report Issue</h3>
                        <p>Capture and report civic problems</p>
                        <div class="card-arrow">‚Üí</div>
                    </div>
                    
                    <div class="dashboard-card" onclick="showView('community-view')">
                        <div class="card-icon">üë•</div>
                        <h3>Community</h3>
                        <p>Connect with your neighbors</p>
                        <div class="card-arrow">‚Üí</div>
                    </div>
                    
                    <div class="dashboard-card" onclick="showView('progress-view')">
                        <div class="card-icon">üìä</div>
                        <h3>Progress</h3>
                        <p>Track your reported issues</p>
                        <div class="card-arrow">‚Üí</div>
                    </div>
                </div>
                
                <div class="quick-stats">
                    <h3>Quick Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">Total Issues</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">98</div>
                            <div class="stat-label">Resolved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">8.5</div>
                            <div class="stat-label">Avg Days</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Issue Reporting View -->
            <div id="report-view" class="view">
                <div class="view-header">
                    <button class="btn btn--secondary" onclick="goBack()">‚Üê Back</button>
                    <h2>Report Issue</h2>
                </div>
                
                <div class="report-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-title">Capture</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-title">AI Analysis</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-title">Voice Note</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-title">Submit</div>
                    </div>
                </div>
                
                <!-- Step 1: Camera Capture -->
                <div id="step-capture" class="report-step active">
                    <div class="camera-container">
                        <video id="camera-feed" autoplay playsinline></video>
                        <canvas id="photo-canvas" class="hidden"></canvas>
                        <div id="photo-preview" class="hidden"></div>
                        
                        <div class="camera-controls">
                            <button class="btn btn--primary camera-btn" onclick="capturePhoto()">üì∑ Capture</button>
                            <input type="file" id="file-input" accept="image/*" onchange="handleFileSelect(event)" class="hidden">
                            <button class="btn btn--secondary" onclick="document.getElementById('file-input').click()">üìÅ Gallery</button>
                        </div>
                    </div>
                    
                    <div class="location-info">
                        <p><strong>üìç Location:</strong> <span id="current-location">Detecting location...</span></p>
                    </div>
                </div>
                
                <!-- Step 2: AI Analysis -->
                <div id="step-analysis" class="report-step">
                    <div class="analysis-container">
                        <div class="analysis-loading">
                            <div class="loading-spinner"></div>
                            <h3>AI is analyzing your image...</h3>
                            <p>Identifying issue type and severity</p>
                        </div>
                        
                        <div class="analysis-result hidden">
                            <h3>Analysis Complete!</h3>
                            <div class="analysis-details">
                                <div class="detected-issue">
                                    <strong>Detected Issue:</strong> <span id="detected-type">Pothole</span>
                                </div>
                                <div class="confidence-score">
                                    <strong>Confidence:</strong> <span id="confidence">92%</span>
                                </div>
                                <div class="severity">
                                    <strong>Severity:</strong> <span id="severity">High</span>
                                </div>
                            </div>
                            
                            <div class="analysis-actions">
                                <button class="btn btn--primary" onclick="acceptAnalysis()">‚úì Correct</button>
                                <button class="btn btn--secondary" onclick="rejectAnalysis()">‚úó Incorrect</button>
                            </div>
                        </div>
                        
                        <div class="manual-category hidden">
                            <h4>Select Issue Category:</h4>
                            <select class="form-control" id="manual-category-select">
                                <option value="">Choose category...</option>
                                <option value="Road Infrastructure">Road Infrastructure</option>
                                <option value="Street Lighting">Street Lighting</option>
                                <option value="Waste Management">Waste Management</option>
                                <option value="Water Supply">Water Supply</option>
                                <option value="Drainage">Drainage</option>
                                <option value="Traffic Issues">Traffic Issues</option>
                                <option value="Public Safety">Public Safety</option>
                                <option value="Parks & Recreation">Parks & Recreation</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3: Voice Recording -->
                <div id="step-voice" class="report-step">
                    <div class="voice-container">
                        <h3>Add Voice Description</h3>
                        <p>Describe the issue in your own words (Optional)</p>
                        
                        <div class="voice-recorder">
                            <button class="btn btn--primary voice-btn" id="record-btn" onclick="toggleRecording()">
                                üé§ Start Recording
                            </button>
                            <div class="recording-status hidden" id="recording-status">
                                <div class="recording-indicator"></div>
                                <span>Recording... <span id="recording-time">0:00</span></span>
                            </div>
                        </div>
                        
                        <div class="voice-playback hidden" id="voice-playback">
                            <audio controls id="recorded-audio"></audio>
                            <div class="playback-actions">
                                <button class="btn btn--secondary" onclick="rerecord()">üîÑ Re-record</button>
                                <button class="btn btn--primary" onclick="proceedToSubmit()">Continue ‚Üí</button>
                            </div>
                        </div>
                        
                        <div class="voice-alternative">
                            <p>or</p>
                            <textarea class="form-control" id="text-description" placeholder="Type your description here..." rows="4"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Final Review -->
                <div id="step-submit" class="report-step">
                    <div class="submit-container">
                        <h3>Review & Submit</h3>
                        
                        <div class="report-preview">
                            <div class="preview-image">
                                <img id="final-image-preview" alt="Issue photo">
                            </div>
                            
                            <div class="preview-details">
                                <div class="detail-row">
                                    <strong>Issue Type:</strong> <span id="final-issue-type">Road Infrastructure</span>
                                </div>
                                <div class="detail-row">
                                    <strong>Location:</strong> <span id="final-location">MG Road, Bangalore</span>
                                </div>
                                <div class="detail-row">
                                    <strong>Description:</strong> <span id="final-description">Large pothole causing vehicle damage</span>
                                </div>
                                <div class="detail-row">
                                    <strong>Priority:</strong> <span id="final-priority" class="status status--error">High</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="privacy-notice">
                            <label class="checkbox-label">
                                <input type="checkbox" id="privacy-agree" checked>
                                I agree to share this information with local authorities for resolution
                            </label>
                        </div>
                        
                        <button class="btn btn--primary btn--full-width" onclick="submitReport()">Submit Report</button>
                    </div>
                </div>
            </div>

            <!-- Community View -->
            <div id="community-view" class="view">
                <div class="view-header">
                    <button class="btn btn--secondary" onclick="goBack()">‚Üê Back</button>
                    <h2>Community</h2>
                </div>
                
                <div class="community-tabs">
                    <button class="tab-btn active" onclick="showCommunityTab('drives')">Community Drives</button>
                    <button class="tab-btn" onclick="showCommunityTab('issues')">Reported Issues</button>
                </div>
                
                <!-- Community Drives Tab -->
                <div id="community-drives" class="community-tab active">
                    <div class="drives-list">
                        <div class="drive-card">
                            <div class="drive-header">
                                <h4>Clean Streets Initiative</h4>
                                <span class="status status--success">Active</span>
                            </div>
                            <p>Community cleanup drive this Sunday</p>
                            <div class="drive-meta">
                                <span>üìÖ Nov 17, 2024</span>
                                <span>üë• 45 participants</span>
                                <span>üìç City Park</span>
                            </div>
                            <button class="btn btn--primary btn--sm">Join Drive</button>
                        </div>
                        
                        <div class="drive-card">
                            <div class="drive-header">
                                <h4>Tree Plantation Drive</h4>
                                <span class="status status--info">Upcoming</span>
                            </div>
                            <p>Plant 100 trees in residential areas</p>
                            <div class="drive-meta">
                                <span>üìÖ Nov 20, 2024</span>
                                <span>üë• 67 participants</span>
                                <span>üìç Various Locations</span>
                            </div>
                            <button class="btn btn--primary btn--sm">Register</button>
                        </div>
                    </div>
                </div>
                
                <!-- Reported Issues Tab -->
                <div id="community-issues" class="community-tab">
                    <div class="issues-filter">
                        <select class="form-control" id="issues-filter">
                            <option value="all">All Issues</option>
                            <option value="Road Infrastructure">Road Infrastructure</option>
                            <option value="Street Lighting">Street Lighting</option>
                            <option value="Waste Management">Waste Management</option>
                        </select>
                    </div>
                    
                    <div class="issues-list" id="community-issues-list">
                        <!-- Issues will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Progress View -->
            <div id="progress-view" class="view">
                <div class="view-header">
                    <button class="btn btn--secondary" onclick="goBack()">‚Üê Back</button>
                    <h2>My Reports</h2>
                </div>
                
                <div class="progress-summary">
                    <div class="summary-stats">
                        <div class="summary-item">
                            <div class="summary-number">3</div>
                            <div class="summary-label">Total Reports</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">1</div>
                            <div class="summary-label">Resolved</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-number">2</div>
                            <div class="summary-label">Active</div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-list" id="user-issues-list">
                    <!-- User issues will be populated by JavaScript -->
                </div>
            </div>

            <!-- Admin Dashboard View -->
            <div id="admin-view" class="view">
                <div class="admin-header">
                    <h2>Admin Dashboard</h2>
                    <button class="btn btn--secondary" onclick="toggleAdminMode()">‚Üê Exit Admin</button>
                </div>
                
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('map')">Issues Map</button>
                    <button class="tab-btn" onclick="showAdminTab('analytics')">Analytics</button>
                    <button class="tab-btn" onclick="showAdminTab('assignments')">Assignments</button>
                </div>
                
                <!-- Issues Map Tab -->
                <div id="admin-map" class="admin-tab active">
                    <div class="map-filters">
                        <select class="form-control" id="status-filter">
                            <option value="">All Status</option>
                            <option value="Reported">Reported</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Resolved">Resolved</option>
                        </select>
                        <select class="form-control" id="category-filter">
                            <option value="">All Categories</option>
                            <option value="Road Infrastructure">Road Infrastructure</option>
                            <option value="Street Lighting">Street Lighting</option>
                            <option value="Waste Management">Waste Management</option>
                        </select>
                    </div>
                    
                    <div class="issues-map">
                        <div class="map-placeholder">
                            üó∫Ô∏è Interactive Map
                            <p>Issues marked with color-coded pins</p>
                            <div class="map-legend">
                                <div class="legend-item"><span class="legend-color" style="background: #ff5555;"></span> High Priority</div>
                                <div class="legend-item"><span class="legend-color" style="background: #ffaa00;"></span> Medium Priority</div>
                                <div class="legend-item"><span class="legend-color" style="background: #00aa00;"></span> Low Priority</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-issues-list" id="admin-issues-list">
                        <!-- Admin issues list will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Analytics Tab -->
                <div id="admin-analytics" class="admin-tab">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Issues by Category</h4>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <h4>Resolution Timeline</h4>
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="timelineChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-summary">
                        <div class="summary-grid">
                            <div class="analytics-stat">
                                <div class="stat-value">1,240</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="analytics-stat">
                                <div class="stat-value">8.5 days</div>
                                <div class="stat-label">Avg Resolution</div>
                            </div>
                            <div class="analytics-stat">
                                <div class="stat-value">62.8%</div>
                                <div class="stat-label">Resolution Rate</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Assignments Tab -->
                <div id="admin-assignments" class="admin-tab">
                    <div class="assignments-list" id="assignments-list">
                        <!-- Assignments will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="showView('dashboard-view')" data-view="dashboard-view">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Home</span>
            </button>
            <button class="nav-btn" onclick="showView('report-view')" data-view="report-view">
                <span class="nav-icon">üì∏</span>
                <span class="nav-label">Report</span>
            </button>
            <button class="nav-btn" onclick="showView('community-view')" data-view="community-view">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Community</span>
            </button>
            <button class="nav-btn" onclick="showView('progress-view')" data-view="progress-view">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Progress</span>
            </button>
            <button class="nav-btn" onclick="toggleAdminMode()" id="admin-nav-btn">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Admin</span>
            </button>
        </nav>
    </div>

    <!-- User Profile Modal -->
    <div id="user-profile-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>User Profile</h3>
                <button class="modal-close" onclick="hideUserProfile()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="profile-info">
                    <div class="profile-avatar">üë§</div>
                    <div class="profile-details">
                        <h4 id="profile-name">Rahul Sharma</h4>
                        <p id="profile-phone">+91-9876543210</p>
                        <p id="profile-address">123 MG Road, Bangalore, Karnataka 560001</p>
                        <p id="profile-aadhaar">AADHAR: ****-****-9012</p>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn btn--secondary btn--full-width" onclick="logout()">Sign Out</button>
                </div>
            </div>
        </div>
        <div class="modal-backdrop" onclick="hideUserProfile()"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>